From 82e33dd5f3420f7b58ef2cd7feefd8b3c74b9b10 Mon Sep 17 00:00:00 2001
From: Laurent Bercot <ska-skaware@skarnet.org>
Date: Tue, 24 Mar 2020 12:27:20 +0000
Subject: [PATCH]  Treat execline as an extra_lib instead of an in-package lib

---
Upstream-Status: Backport
 AUTHORS                                 | 1 +
 configure                               | 4 ++--
 package/deps.mak                        | 8 ++++----
 src/pipe-tools/deps-exe/s6-ftrig-listen | 2 +-
 src/supervision/deps-exe/s6-svlisten    | 2 +-
 5 files changed, 9 insertions(+), 8 deletions(-)

diff --git a/AUTHORS b/AUTHORS
index bb02b38..e619bcb 100644
--- a/AUTHORS
+++ b/AUTHORS
@@ -34,3 +34,4 @@ Thanks to:
   Jonathan de Boyne Pollard <J.deBoynePollard@NTLWorld.com>
   Luis Ressel <aranea@aixah.de>
   Eric Vidal <eric@obarun.org>
+  Jens Rehsack <rehsack@gmail.com>
diff --git a/configure b/configure
index 7838b5b..d80c4e0 100755
--- a/configure
+++ b/configure
@@ -453,9 +453,9 @@ else
   echo "MAYBEPTHREAD_LIB :="
 fi
 if $useexecline ; then
-  echo "LIBEXECLINE := -lexecline"
+  echo "EXECLINE_LIB := -lexecline"
 else
-  echo "LIBEXECLINE :="
+  echo "EXECLINE_LIB :="
 fi
 
 exec 1>&3 3>&-
diff --git a/package/deps.mak b/package/deps.mak
index be31d08..9d61497 100644
--- a/package/deps.mak
+++ b/package/deps.mak
@@ -218,8 +218,8 @@ s6lockd-helper: EXTRA_LIBS := -lskarnet
 s6lockd-helper: src/libs6/s6lockd-helper.o
 s6-cleanfifodir: EXTRA_LIBS := -lskarnet
 s6-cleanfifodir: src/pipe-tools/s6-cleanfifodir.o ${LIBS6}
-s6-ftrig-listen: EXTRA_LIBS := -lskarnet ${SOCKET_LIB} ${SYSCLOCK_LIB} ${SPAWN_LIB}
-s6-ftrig-listen: src/pipe-tools/s6-ftrig-listen.o ${LIBS6} ${LIBEXECLINE}
+s6-ftrig-listen: EXTRA_LIBS := ${EXECLINE_LIB} -lskarnet ${SOCKET_LIB} ${SYSCLOCK_LIB} ${SPAWN_LIB}
+s6-ftrig-listen: src/pipe-tools/s6-ftrig-listen.o ${LIBS6}
 s6-ftrig-listen1: EXTRA_LIBS := -lskarnet ${SOCKET_LIB} ${SYSCLOCK_LIB} ${SPAWN_LIB}
 s6-ftrig-listen1: src/pipe-tools/s6-ftrig-listen1.o ${LIBS6}
 s6-ftrig-notify: EXTRA_LIBS := -lskarnet
@@ -240,8 +240,8 @@ s6-svdt: EXTRA_LIBS := -lskarnet
 s6-svdt: src/supervision/s6-svdt.o ${LIBS6}
 s6-svdt-clear: EXTRA_LIBS := -lskarnet
 s6-svdt-clear: src/supervision/s6-svdt-clear.o ${LIBS6}
-s6-svlisten: EXTRA_LIBS := -lskarnet ${SOCKET_LIB} ${SYSCLOCK_LIB} ${SPAWN_LIB}
-s6-svlisten: src/supervision/s6-svlisten.o src/supervision/s6_svlisten_signal_handler.o src/supervision/s6_svlisten_loop.o ${LIBS6} ${LIBEXECLINE}
+s6-svlisten: EXTRA_LIBS := ${EXECLINE_LIB} -lskarnet ${SOCKET_LIB} ${SYSCLOCK_LIB} ${SPAWN_LIB}
+s6-svlisten: src/supervision/s6-svlisten.o src/supervision/s6_svlisten_signal_handler.o src/supervision/s6_svlisten_loop.o ${LIBS6}
 s6-svlisten1: EXTRA_LIBS := -lskarnet ${SOCKET_LIB} ${SYSCLOCK_LIB} ${SPAWN_LIB}
 s6-svlisten1: src/supervision/s6-svlisten1.o src/supervision/s6_svlisten_signal_handler.o src/supervision/s6_svlisten_loop.o ${LIBS6}
 s6-svok: EXTRA_LIBS := -lskarnet
diff --git a/src/pipe-tools/deps-exe/s6-ftrig-listen b/src/pipe-tools/deps-exe/s6-ftrig-listen
index 2d6e6d4..4920473 100644
--- a/src/pipe-tools/deps-exe/s6-ftrig-listen
+++ b/src/pipe-tools/deps-exe/s6-ftrig-listen
@@ -1,5 +1,5 @@
 ${LIBS6}
-${LIBEXECLINE}
+${EXECLINE_LIB}
 -lskarnet
 ${SOCKET_LIB}
 ${SYSCLOCK_LIB}
diff --git a/src/supervision/deps-exe/s6-svlisten b/src/supervision/deps-exe/s6-svlisten
index a7bbbfa..0f632fc 100644
--- a/src/supervision/deps-exe/s6-svlisten
+++ b/src/supervision/deps-exe/s6-svlisten
@@ -1,7 +1,7 @@
 s6_svlisten_signal_handler.o
 s6_svlisten_loop.o
 ${LIBS6}
-${LIBEXECLINE}
+${EXECLINE_LIB}
 -lskarnet
 ${SOCKET_LIB}
 ${SYSCLOCK_LIB}
-- 
2.24.1 (Apple Git-126)

